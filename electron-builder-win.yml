# Hardened Windows Build Configuration for Electron v37.2.6
# Fixes: Missing shortcuts, uninstallation failures, NSIS integrity issues

appId: com.anava.installer
productName: Anava Installer
directories:
  output: dist
  buildResources: build

win:
  target:
    - target: nsis
      arch:
        - x64
        - ia32
  
  # Code signing configuration
  certificateFile: ${env.WIN_CSC_LINK}
  certificatePassword: ${env.WIN_CSC_KEY_PASSWORD}
  signingHashAlgorithms: 
    - sha256
  signDlls: true
  verifyUpdateCodeSignature: true
  
  # Application metadata
  legalTrademarks: "Â© 2025 Anava AI"
  publisherName: "Anava AI Inc."
  
  # Icon and visual assets
  icon: build/icon.ico
  
  # File associations
  fileAssociations:
    - ext: anava
      name: Anava Configuration File
      description: Anava Infrastructure Configuration
      icon: build/icon.ico

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  allowElevation: true
  
  # Custom NSIS script with fixes
  include: installer-scripts/installer.nsh
  script: installer-scripts/installer.nsh
  
  # Installer metadata
  installerIcon: build/icon.ico
  uninstallerIcon: build/icon.ico
  installerHeader: build/installerHeader.bmp
  installerSidebar: build/installerSidebar.bmp
  
  # License and documentation
  license: LICENSE.txt
  
  # Shortcut configuration - CRITICAL FOR FIX
  createDesktopShortcut: always
  createStartMenuShortcut: true
  shortcutName: "Anava Installer"
  menuCategory: "Anava AI"
  
  # Uninstaller configuration - CRITICAL FOR FIX
  deleteAppDataOnUninstall: false
  removeDefaultUninstallWelcomePage: false
  uninstallDisplayName: "Anava Installer"
  
  # NSIS specific settings for integrity
  unicode: true
  warningsAsErrors: true
  packElevateHelper: true
  
  # Installation modes
  differentialPackage: false
  
  # Language support
  language: 1033 # English
  multiLanguageInstaller: false
  
  # GUID for consistent uninstallation
  guid: "6B3E5A7C-9D4F-4E2A-8C1B-F9E8D3A2C5B7"
  
  # Additional installer options
  runAfterFinish: true
  displayLanguageSelector: false
  installerLanguages:
    - en-US
  
  # Artifact naming
  artifactName: ${productName}-Setup-${version}-${arch}.exe

# Compression settings for better integrity
compression: maximum
compressionLevel: 9

# Publishing configuration (optional)
publish:
  - provider: generic
    url: https://github.com/AnavaAcap/acap-releases/releases/download/v3.8.1/

# Extra metadata for Windows
extraMetadata:
  name: anava-installer
  version: 0.9.178
  description: "Anava Infrastructure Deployer - Enterprise AI Video Analytics"
  author: "Anava AI Inc."
  main: dist/main/index.js